---
locale: pt-BR
title: "NPM - Peer dependencies"
keywords: ["package.json", "dependencies", "devDependencies", "peerDependencies", "peerDependenciesMeta", "optionalDependencies"]
slug: npm-peer-dependencies
createdAt: 2023-03-19T00:00:00
categorySlug: packages
description: "Finalmente entendendo as peerDependencies"
thumbnailLarge: "/images/npm-dependencies/technology-1920x1077.webp"
---

## Introdu√ß√£o

Por muitas vezes olhando o **package.json** me questionei sobre qual era a diferen√ßa entre **dependencies**, **devDependencies**,
**peerDependencies**, **peerDependenciesMeta** e **optionalDependencies**.

O objetivo deste post √© te ajudar a entender para que servem as **peerDependencies**.

Caso se interesse tamb√©m em entender **optionalDependencies**, basta acessar [NPM - Optional dependencies](/pt-BR/post/npm-optional-dependencies).

## Um resumo sobre o package.json

O arquivo **package.json** √© um manifesto para projetos Node.js. Nele cont√©m informa√ß√µes sobre o projeto (nome, vers√£o, autores, depend√™ncias,
licen√ßa, scripts, entre outras informa√ß√µes). Para cri√°-lo em um projeto, basta executar `npm init`.

Neste arquivo temos algumas defini√ß√µes que est√£o relacionadas a depend√™ncias do projeto. Um resumo sobre cada uma delas:

- **dependencies:** Depend√™ncias necess√°rias para o projeto funcionar em ambiente de produ√ß√£o;
- **devDependencies:** Depend√™ncias necess√°rias para o projeto funcionar em ambiente de desenvolvimento;
- **peerDependencies:** Depend√™ncias necess√°rias que o usu√°rio do projeto deve instalar para utilizar outras depend√™ncias;
- **peerDependenciesMeta:** Informa√ß√µes adicionais sobre as peerDependencies;
- **optionalDependencies:** Depend√™ncias que podem ser instaladas ou n√£o. A falta delas n√£o compromete no funcionamento correto do projeto.

## PeerDependencies

As depend√™ncias entre pares mudam um pouco como enxergamos a necessidade de ter pacotes externos em nosso c√≥digo. Quando estamos desenvolvendo um
projeto que _n√£o ser√°_ um "Plug and Play", n√£o faz sentido utilizar as depend√™ncias entre pares. Digo isto, pois nosso projeto n√£o ter√° outras
responsabilidades al√©m de compilar e rodar em produ√ß√£o, j√° que √© o nosso c√≥digo final.

Agora quando falamos de bibliotecas que ser√£o compartilhadas, configurar algumas depend√™ncias assim ser√° extremamente √∫til. Elas dar√£o a liberdade aos
nossos usu√°rios de instalarem a vers√£o que desejam e assim poder compartilhar de uma mesma depend√™ncia instalada entre diferentes bibliotecas.

Por exemplo, imagina que voc√™ est√° construindo 2 bibliotecas diferentes de componentes para aplica√ß√µes React. A biblioteca A1 exportar√° o componente
Bot√£o. J√° a biblioteca A2 exportar√° o componente Input. Em ambas bibliotecas ser√° necess√°rio instalar os pacotes `react` e `react-dom`.

**Problema**

Se para a biblioteca A1 as vers√µes do React forem `16.10.0` e na A3 `16.11.0`, isso pode levar a conflitos de vers√£o quando o usu√°rio for utilizar
ambas em seu projeto. Para evitar este problema, podemos definir estas vers√µes como **peerDependencies**, assim o usu√°rio da biblioteca poder√° ter o
controle sobre a vers√£o do react que ser√° utilizada.

Outro ponto a se considerar, √© que para utilizar alguma dessas bibliotecas o usu√°rio j√° precisaria ter em seu projeto o react, ent√£o deixar este
controle de vers√£o com ele, faz total sentido.

Para ajudar no entendimento, vamos criar 3 bibliotecas bem simples e uma aplica√ß√£o de teste.

> Para estes exemplos estou utilizando npm - 9.6.1 e node - 16.17.0

### Criando nossas bibliotecas

Nossas bibliotecas ser√£o respons√°veis por retornar a diferen√ßa de uma lista para a outra e exibir no terminal a vers√£o que estamos utilizando dentro e
fora da biblioteca para um mesmo pacote.

1. Crie uma nova pasta e um arquivo `package.json`.

   ```bash
   # Vai criar uma pasta chamada my-lib
   mkdir my-lib &&
   # Vai entrar na pasta criada
   cd my-lib &&
   # Vai criar um arquivo chamado `package.json`
   npm init -y
   ```

2. Altere o `package.json` para:

   ```json
   {
     "name": "my-lib",
     "version": "1.0.0",
     "scripts": {
       "pack": "npm pack"
     },
     "peerDependencies": {
       "lodash": "^4.17.0"
     }
   }
   ```

   **npm pack** - Ir√° empacotar nossa biblioteca gerando um arquivo **.tgz**

3. Crie um arquivo chamado `index.js`

   ```js
   const _ = require("lodash");

   const difference = (logMessage, arr1, arr2) => {
     const diff = _.difference(arr1, arr2);

     console.log(logMessage, "- lodash version:", _.VERSION);

     return diff;
   };

   module.exports = difference;
   ```

4. Instale as depend√™ncias e empacote a biblioteca

   ```bash
   # Abra o terminal na pasta do projeto `my-lib`
   # E instale as depend√™ncias
   npm install &&
   # Vai executar nosso script `pack` que ir√° empacotar nossa biblioteca
   # gerando o arquivo `my-lib-1.0.0.tgz`
   npm run pack
   ```

5. Se tudo deu certo sua estrutura de pastas deve estar assim:

   ```bash
     # |-- my-lib/
   # |------ index.js
   # |------ my-lib-1.0.0.tgz
   # |------ package-lock.json
   # |------ package.json
   ```

   ##### Pausa para explica√ß√£o

   - Como no passo 2 colocamos o **lodash** como **peerDependencies**, observe que ao instalar as depend√™ncias (passo 4) **n√£o criou um
     node_modules**. Isso, pois o ato de definir a depend√™ncia assim, faz com que quem a use seja obrigado a instal√°-la.
   - Como colocamos **^4.17.0**, significa que a vers√£o m√≠nima do **lodash** necess√°ria para **my-lib** funcionar como esperamos √© a vers√£o
     **4.17.0**.

6. Criar **my-lib-2**

   Vamos duplicar o projeto **my-lib**.

   > Se preferir pode usar o famoso `CTRL + C` `CTRL + V`

   ```bash
     # Abra um novo terminal
   # Cria pasta my-lib-2
   mkdir my-lib-2 &&
   # Para copiar `my-lib/index.js` e `my-lib/package.json` para `my-lib-2`
   cp my-lib/index.js my-lib-2/index.js &&
   cp my-lib/package.json my-lib-2/package.json &&
   # Vai entrar na pasta criada
   cd my-lib-2
   ```

7. Altere o `package.json` para:
   ```json
   {
     "name": "my-lib-2",
     "version": "1.0.0",
     "scripts": {
       "pack": "npm pack"
     },
     "dependencies": {
       "lodash": "^4.17.0"
     }
   }
   ```
8. Instale as depend√™ncias e empacote a biblioteca

   ```bash
   # Abra o terminal na pasta do projeto `my-lib-2`
   # E instale as depend√™ncias
   npm install &&
   # Vai executar nosso script `pack` que ir√° empacotar nossa biblioteca
   # gerando o arquivo `my-lib-2-1.0.0.tgz`
   npm run pack
   ```

9. Se tudo deu certo sua estrutura de pastas deve estar assim:

   ```bash
     # |-- my-lib/
   # |------ index.js
   # |------ my-lib-1.0.0.tgz
   # |------ package-lock.json
   # |------ package.json

   # |-- my-lib-2/
   # |------ node_modules/
   # |------------ lodash/
   # |------ index.js
   # |------ my-lib-2-1.0.0.tgz
   # |------ package-lock.json
   # |------ package.json
   ```

   ##### Pausa para explica√ß√£o

   - Como na nossa **my-lib-2** definimos o **lodash** como **dependencies**, n√£o √© necess√°rio que o usu√°rio instale o **lodash**. Como nossa
     biblioteca far√° isso automaticamente, este foi o motivo pelo qual temos a pasta **node_modules**.
   - Como colocamos **^4.17.0**, significa que a vers√£o m√≠nima do **lodash** necess√°ria para **my-lib-2** funcionar como esperamos √© a vers√£o
     **4.17.0**.

10. Criar **my-lib-3**

    Vamos duplicar o projeto **my-lib**.

    > Se preferir pode usar o famoso `CTRL + C` `CTRL + V`

    ```bash
      # Abra um novo terminal
    # Cria pasta my-lib-3
    mkdir my-lib-3 &&
    #Para copiar `my-lib/index.js` e `my-lib/package.json` para `my-lib-3`
    cp my-lib/index.js my-lib-3/index.js &&
    cp my-lib/package.json my-lib-3/package.json &&
    # Vai entrar na pasta criada
    cd my-lib-3
    ```

11. Altere o `package.json` para:
    ```json
    {
      "name": "my-lib-3",
      "version": "1.0.0",
      "scripts": {
        "pack": "npm pack"
      },
      "dependencies": {
        "lodash": "4.17.0"
      }
    }
    ```
12. Instale as depend√™ncias e empacote a biblioteca

    ```bash
    # Abra o terminal na pasta do projeto `my-lib-3`
    # E instale as depend√™ncias
    npm install &&
    # Vai executar nosso script `pack` que ir√° empacotar nossa biblioteca
    # gerando o arquivo `my-lib-3-1.0.0.tgz`
    npm run pack
    ```

13. Se tudo deu certo sua estrutura de pastas deve estar assim:

    ```bash
      # |-- my-lib/
    # |------ index.js
    # |------ my-lib-1.0.0.tgz
    # |------ package-lock.json
    # |------ package.json

    # |-- my-lib-2/
    # |------ node_modules/
    # |------------ lodash/
    # |------ index.js
    # |------ my-lib-2-1.0.0.tgz
    # |------ package-lock.json
    # |------ package.json

    # |-- my-lib-3/
    # |------ node_modules/
    # |------------ lodash/
    # |------ index.js
    # |------ my-lib-3-1.0.0.tgz
    # |------ package-lock.json
    # |------ package.json

    ```

    ##### Pausa para explica√ß√£o

    - Como na nossa **my-lib-3** definimos o **lodash** como **dependencies**, n√£o √© necess√°rio que o usu√°rio instale o **lodash**. Como nossa
      biblioteca far√° isso autom√°ticamente, este foi o motivo pelo qual temos a pasta **node_modules**.
    - Como colocamos **4.17.0** e n√£o **^4.17.0**, significa que a vers√£o do **lodash** necess√°ria para **my-lib-3** funcionar √© a vers√£o **4.17.0**.
      <br />

    > Provavelmente voc√™ deve estar pensando que a √∫nica diferen√ßa entre **my-lib**, **my-lib-2** e **my-lib-3** √â o fato de obrigar ou n√£o o usu√°rio
    > a instalar uma biblioteca a mais ao utiliz√°-las. Se este √© seu pensamento, fique calmo e vamos para o grande final.

14. Criando aplica√ß√£o para testar nossa biblioteca

    ```bash
    # Abra um novo terminal
    # Vai criar uma pasta chamada my-app
    mkdir my-app &&
    # Vai entrar na pasta criada
    cd my-app &&
    # Vai criar um arquivo chamado `package.json`
    npm init -y
    ```

15. Altere o `package.json` para:

    ```json
    {
      "name": "my-app",
      "version": "1.0.0",
      "scripts": {
        "test": "node index.js"
      },
      "dependencies": {
        "lodash": "^4.17.21",
        "my-lib": "file:../my-lib/my-lib-1.0.0.tgz",
        "my-lib-2": "file:../my-lib-2/my-lib-2-1.0.0.tgz",
        "my-lib-3": "file:../my-lib-3/my-lib-3-1.0.0.tgz"
      }
    }
    ```

16. Crie um arquivo chamado `index.js`

    ```js
    const _ = require("lodash");
    const myLib = require("my-lib");
    const myLib2 = require("my-lib-2");
    const myLib3 = require("my-lib-3");

    const arr1 = [1, 2, 3, 4];
    const arr2 = [1, 2, 4];

    myLib("my-lib", arr1, arr2);
    myLib2("my-lib-2", arr1, arr2);
    myLib3("my-lib-3", arr1, arr2);

    console.log("my-app lodash version:", _.VERSION);
    ```

17. Instale as depend√™ncias

    ```bash
    # Abra o terminal na pasta do projeto `my-app`
    ## E instale as depend√™ncias
    npm install
    ```

18. Se tudo deu certo sua estrutura de pastas deve estar assim:

    ```bash
      # |-- my-lib/
    # |------ index.js
    # |------ my-lib-1.0.0.tgz
    # |------ package-lock.json
    # |------ package.json

    # |-- my-lib-2/
    # |------ node_modules/
    # |------------ lodash/
    # |------ index.js
    # |------ my-lib-2-1.0.0.tgz
    # |------ package-lock.json
    # |------ package.json

    # |-- my-lib-3/
    # |------ node_modules/
    # |------------ lodash/
    # |------ index.js
    # |------ my-lib-3-1.0.0.tgz
    # |------ package-lock.json
    # |------ package.json

    # |-- my-app/
    # |------ node_modules/
    # |------------ lodash/
    # |------------ my-lib/
    # |------------ my-lib-2/
    # |------------ my-lib-3/
    # |------------ package-lock.json
    # |------ index.js
    # |------ package-lock.json
    # |------ package.json
    ```

19. Por fim, execute **npm test** O resultado no terminal ser√°:

    ```bash
        > my-app@1.0.0 test
    > node index.js

    my-lib - lodash version: 4.17.21
    my-lib-2 - lodash version: 4.17.21
    my-lib-3 - lodash version: 4.17.0
    my-app lodash version: 4.17.21
    ```

### Explica√ß√£o

Em todas nossas bibliotecas, colocamos no **index.js** um **console.log** para exibir a vers√£o do lodash que estava sendo executada.

O nosso log da biblioteca **my-lib** indica a vers√£o 4.17.21 do lodash. Isso porque nela, o lodash est√° como peerDependencies e com regra de vers√£o
m√≠nima. Logo somos obrigados a ter **lodash** instalado em nosso **my-app**.

> Leia novamente a **Pausa para explica√ß√£o** no passo 5.

O nosso log da biblioteca **my-lib-2** indica a vers√£o 4.17.21 do lodash. Isso porque nela, o lodash est√° como dependencies com vers√£o m√≠nima 4.17.0.
Como instalamos uma vers√£o superior a 4.17.0 no **my-app** e ela √© est√° dentro das regras do **my-lib-2**, ela √© usada para ambos.

> Leia novamente a **Pausa para explica√ß√£o** no passo 9.

O nosso log da biblioteca **my-lib-3** indica a vers√£o 4.17.0 do lodash. Isso porque nela, o lodash est√° como dependencies com vers√£o fixa em 4.17.0.
Como instalamos uma vers√£o diferente no **my-app**, ele n√£o pode reaproveitar, logo s√£o instaladas duas vers√µes diferentes do lodash. Uma para a
**my-lib-3** e outra para **my-app**.

> Leia novamente a **Pausa para explica√ß√£o** no passo 13.

E nosso √∫ltimo log indica qual a vers√£o do lodash que foi instalada em **my-app**.

### Desinstalando e gerando erro

Entendemos que por conta da **my-lib** somos obrigados a ter o lodash instalado em **my-app**, vamos ent√£o desinstal√°-lo e ver o que acontece.

1. Desinstalar lodash do **my-app**

   ```bash
     # Abra o terminal em my-app
     npm uninstall lodash
   ```

2. Executando teste

   ```bash
   npm test
   ```

3. U√©, por que n√£o deu erro ?

   Como as depend√™ncias **my-lib-2** e **my-lib-3** possuem lodash como **dependencie**. Ao instalar elas em nosso projeto, o lodash tamb√©m √©
   instalado. Logo **my-lib** pode acess√°-lo.

4. Desinstalando **my-lib-2** e **my-lib-3**

   Vamos fazer duas altera√ß√µes, uma no `index.js`:

   ```js
   const _ = require("lodash");
   const mylib = require("my-lib");
   // const mylib2 = require("my-lib-2");
   // const mylib3 = require("my-lib-3");

   const arr1 = [1, 2, 3, 4];
   const arr2 = [1, 2, 4];

   mylib("my-lib", arr1, arr2);
   // mylib2("my-lib-2", arr1, arr2);
   // mylib3("my-lib-3", arr1, arr2);

   console.log("my-app lodash version:", _.VERSION);
   ```

   E no `package.json`:

   ```json
   {
     "name": "my-app",
     "version": "1.0.0",
     "scripts": {
       "test": "node index.js"
     },
     "dependencies": {
       "my-lib": "file:../my-lib/my-lib-1.0.0.tgz"
     }
   }
   ```

   Agora vamos instalar as depend√™ncias novamente e executar nosso teste.

   ```bash
   npm install && npm test
   ```

   üí£ BOOOM. Agora sim, deu erro:

   ```bash
   # Error: Cannot find module 'lodash'
   # Require stack: ....
   ```

   Isso aconteceu, pois ficou apenas nossa depend√™ncia que precisa do lodash e que nela o lodash est√° como **peerDependencies**.

5. E se instalarmos uma vers√£o abaixo da definida em peerDependencies ?

   Se voc√™ lembra, definimos uma vers√£o m√≠nima necess√°ria para garantir o funcionamento do lodash em nossa biblioteca **my-lib**. O que ser√° que
   acontecer√° se instalarmos uma vers√£o anterior a m√≠nima definida ? ü§î

   ```bash
    npm install lodash@3 && npm test
   ```

   üòØ Uooou! Nosso c√≥digo executou com sucesso.

   > Ent√£o devemos sempre ter aten√ß√£o com os pacotes que utilizamos e boas coberturas de testes para evitar uma troca incorreta de vers√£o, n√£o
   > percebendo o grande problema que isso pode causar.

   Agora vamos manter est√° vers√£o do lodash e voltar com nossas outras bibliotecas e ver o que acontecer√°.

6. Voltando com **my-lib-2** e **my-lib-3**

Vamos fazer duas altera√ß√µes, uma no `index.js`:

```js
const _ = require("lodash");
const mylib = require("my-lib");
const mylib2 = require("my-lib-2");
const mylib3 = require("my-lib-3");

const arr1 = [1, 2, 3, 4];
const arr2 = [1, 2, 4];

mylib("my-lib", arr1, arr2);
mylib2("my-lib-2", arr1, arr2);
mylib3("my-lib-3", arr1, arr2);

console.log("my-app lodash version:", _.VERSION);
```

E no `package.json`:

```json
{
  "name": "my-app",
  "version": "1.0.0",
  "scripts": {
    "test": "node index.js"
  },
  "dependencies": {
    "lodash": "^3.10.1",
    "my-lib": "file:../my-lib/my-lib-1.0.0.tgz",
    "my-lib-2": "file:../my-lib-2/my-lib-2-1.0.0.tgz",
    "my-lib-3": "file:../my-lib-3/my-lib-3-1.0.0.tgz"
  }
}
```

Agora vamos instalar as depend√™ncias novamente e executar nosso teste.

```bash
npm install && npm test
```

ü§Ø Nossa sa√≠da:

```bash
     > my-app@1.0.0 test
 > node index.js

 my-lib - lodash version: 3.10.1
 my-lib-2 - lodash version: 4.17.21
 my-lib-3 - lodash version: 4.17.0
 my-app lodash version: 3.10.1
```

Esperava, por essa? ü§£ü§£

- Como **my-lib** est√° com **lodash** como **peerDependencies**, ela considerou a vers√£o que instalamos em **my-app**.
- Como **my-lib-2** est√° com **lodash** como **dependencies**, ela n√£o utilizou a vers√£o que temos em **my-app** e garantiu instalando o lodash na
  vers√£o que ela precisa.
- Como **my-lib-3** est√° com **lodash** com uma vers√£o fixa em **dependencies**, ela n√£o utilizou a vers√£o que temos em **my-app** e garantiu
  instalando o lodash na vers√£o que ela precisa.

Bom, espero ter te ajudado de alguma forma.

## Refer√™ncias

- [package.json](https://docs.npmjs.com/cli/v7/configuring-npm/package-json);
